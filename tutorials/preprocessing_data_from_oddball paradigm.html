
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>EEG Preprocessing for an Oddball Paradigm &#8212; mvpure_py 1.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=d6b6a36a"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/preprocessing_data_from_oddball paradigm';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Source localization and signal reconstruction - case study for oddball data" href="source_localization_and_reconstruction_on_data_from_oddball_paradigm.html" />
    <link rel="prev" title="mvpure_py.utils" href="../mvpure_py.utils.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt=""/>
    <img src="../_static/logo.png" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">mvpure_py</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"></div>
</nav></div>
        <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">EEG Preprocessing for an Oddball Paradigm</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <style>
/* Make all output cells scrollable if they are tall */
div.nboutput:not(:has(div.figure)) {
    max-height: 380px;
    overflow-y: auto;
    padding: 2px;
}
</style><p>Author: Krzysztof To≈Çpa</p>
<section id="EEG-Preprocessing-for-an-Oddball-Paradigm">
<h1>EEG Preprocessing for an Oddball Paradigm<a class="headerlink" href="#EEG-Preprocessing-for-an-Oddball-Paradigm" title="Link to this heading">#</a></h1>
<p>Preprocessing is a critical step in EEG analysis. It involves cleaning the data to remove noise and artifacts ‚Äî signals that are not of neural origin ‚Äî which can otherwise contaminate our results. We use <strong>MNE-Python</strong> library accompanied with adapted from <strong>EEGLAB</strong> functions: <code class="docutils literal notranslate"><span class="pre">rejchanspec</span></code> and <code class="docutils literal notranslate"><span class="pre">trimoutlier</span></code>. We also utilize <code class="docutils literal notranslate"><span class="pre">mne-icalabel</span></code> plugin for automatic classification ICA components.</p>
<p>Our pipeline covers commonly applied steps:</p>
<ol class="arabic simple">
<li><p><strong>Loading Data</strong>: Importing the raw EEG recording.</p></li>
<li><p><strong>Channel Management</strong>: Handling channel locations, names, and types.</p></li>
<li><p><strong>Filtering</strong>: Applying high-pass and low-pass filters to isolate the frequency bands of interest.</p></li>
<li><p><strong>Artifact Detection</strong>: Identifying and marking bad channels and noisy time segments.</p></li>
<li><p><strong>Artifact Removal with ICA</strong>: Using Independent Component Analysis (ICA) to remove stereotyped artifacts like eye blinks and muscle activity.</p></li>
<li><p><strong>Interpolation &amp; Resampling</strong>: Reconstructing bad channels and downsampling the data to make it more manageable.</p></li>
<li><p><strong>Epoching</strong>: Segmenting the continuous data into trials (epochs) centered around our experimental events.</p></li>
</ol>
<p>Let‚Äôs get started!</p>
<section id="1.-Setup:-Importing-Necessary-Libraries">
<h2>1. Setup: Importing Necessary Libraries<a class="headerlink" href="#1.-Setup:-Importing-Necessary-Libraries" title="Link to this heading">#</a></h2>
<p>First things first, we need to import all the Python packages we‚Äôll use throughout the analysis.</p>
<p>Filr with <code class="docutils literal notranslate"><span class="pre">preprocessing_utils</span></code> can be found on <a class="reference external" href="https://github.com/julia-jurkowska/supFunSim-py/blob/dev/tutorials/preprocessing_utils.py">github</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">mne</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">os.path</span><span class="w"> </span><span class="kn">import</span> <span class="n">join</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">preprocessing_utils</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">utils</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mne.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">ICA</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mne_icalabel</span><span class="w"> </span><span class="kn">import</span> <span class="n">label_components</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;TkAgg&#39;</span><span class="p">)</span> <span class="c1"># so that the figures will pop up outside the cells</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="2.-Loading-and-Inspecting-Raw-Data">
<h2>2. Loading and Inspecting Raw Data<a class="headerlink" href="#2.-Loading-and-Inspecting-Raw-Data" title="Link to this heading">#</a></h2>
<p>Now, we‚Äôll define the file paths and load our raw data. We are working with data in the <strong>BrainVision</strong> format, which consists of three files (<code class="docutils literal notranslate"><span class="pre">.vhdr</span></code>, <code class="docutils literal notranslate"><span class="pre">.vmrk</span></code>, <code class="docutils literal notranslate"><span class="pre">.eeg</span></code>). MNE conveniently handles this by pointing to the header file (<code class="docutils literal notranslate"><span class="pre">.vhdr</span></code>).</p>
<p>We set <code class="docutils literal notranslate"><span class="pre">preload=True</span></code> to load the entire dataset into memory. This is necessary for many preprocessing steps, especially filtering and ICA.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">subjects_dir</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span>
<span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;sample_subject&#39;</span>

<span class="n">filepath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">subjects_dir</span><span class="p">,</span><span class="n">subject</span><span class="p">,</span><span class="s1">&#39;_eeg&#39;</span><span class="p">,</span><span class="s1">&#39;_raw&#39;</span><span class="p">)</span>

<span class="n">filename</span> <span class="o">=</span> <span class="n">subject</span><span class="o">+</span><span class="s1">&#39;_oddball.vhdr&#39;</span>

<span class="n">raw</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_raw_brainvision</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">preload</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Extracting parameters from /Volumes/UMK/oddball/subjects/sample_subject/_eeg/_raw/sample_subject_oddball.vhdr...
Setting channel info structure...
Reading 0 ... 1329199  =      0.000 ...  1329.199 secs...
</pre></div></div>
</div>
<section id="Visual-Inspection">
<h3>Visual Inspection<a class="headerlink" href="#Visual-Inspection" title="Link to this heading">#</a></h3>
<p>Before diving into any processing, let‚Äôs <strong>look at the data</strong>. This first-pass visual check can help you spot major problems like dead channels (completely flat lines), extreme electrical noise, or large movement artifacts. The <code class="docutils literal notranslate"><span class="pre">raw.plot()</span></code> function is an interactive tool that lets you scroll through your data. It can be run at any step of the preprocessing to monitor the results.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># raw.plot()</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="3.-Channel-Management">
<h2>3. Channel Management<a class="headerlink" href="#3.-Channel-Management" title="Link to this heading">#</a></h2>
<p>Properly defining our channels is a foundational step. This involves removing non-essential channels and ensuring the remaining ones are correctly typed before we assign their 3D locations.</p>
<ul class="simple">
<li><p><strong>Dropping Unwanted Channels</strong>: We first remove any channels that are not EEG sensors, such as <strong>EMG</strong> (muscle) or <strong>EOG</strong> (eye movement) channels.</p></li>
<li><p><strong>Setting Channel Types</strong>: We then ensure that all channels intended as EEG sensors are correctly labeled. Mastoid channels like <code class="docutils literal notranslate"><span class="pre">TP9</span></code> and <code class="docutils literal notranslate"><span class="pre">TP10</span></code> were assigned <code class="docutils literal notranslate"><span class="pre">'misc'</span></code> category since they were attached to the earlobes. We explicitly set them to <code class="docutils literal notranslate"><span class="pre">'eeg'</span></code>, their location will be adjusted when we load individual montage.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">drop_channels</span><span class="p">([</span><span class="s2">&quot;EMG&quot;</span><span class="p">,</span> <span class="s2">&quot;EOG&quot;</span><span class="p">])</span>

<span class="n">raw</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">set_channel_types</span><span class="p">({</span><span class="s2">&quot;TP9&quot;</span><span class="p">:</span> <span class="s2">&quot;eeg&quot;</span><span class="p">,</span> <span class="s2">&quot;TP10&quot;</span><span class="p">:</span><span class="s2">&quot;eeg&quot;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<section id="Setting-the-Montage-(Electrode-Locations)">
<h3>Setting the Montage (Electrode Locations)<a class="headerlink" href="#Setting-the-Montage-(Electrode-Locations)" title="Link to this heading">#</a></h3>
<p>To know where our electrodes were on the participant‚Äôs head, we need to apply a <strong>montage</strong>. A montage file contains the 3D coordinates of each sensor. This is essential for:</p>
<ul class="simple">
<li><p>Topographical plots (visualizing scalp activity).</p></li>
<li><p>Interpolating bad channels based on their neighbors.</p></li>
<li><p>Source localization analyses.</p></li>
</ul>
<p>Here, we‚Äôre loading a subject‚Äôs individual <code class="docutils literal notranslate"><span class="pre">.bvct</span></code> file, which is a format from the Captrak digitizer system, and applying it to our <code class="docutils literal notranslate"><span class="pre">raw</span></code> object.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get channel positions</span>

<span class="n">montage_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">subjects_dir</span><span class="p">,</span><span class="n">subject</span><span class="p">,</span><span class="s1">&#39;_eeg&#39;</span><span class="p">,</span><span class="s1">&#39;montage&#39;</span><span class="p">,</span><span class="s1">&#39;captrak&#39;</span><span class="p">)</span>
<span class="n">montage_name</span> <span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="s1">_captrak.bvct&#39;</span>
<span class="n">montage</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">read_dig_captrak</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">montage_path</span><span class="p">,</span> <span class="n">montage_name</span><span class="p">))</span>
<span class="n">raw</span><span class="o">.</span><span class="n">set_montage</span><span class="p">(</span><span class="n">montage</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<script type="text/javascript">
    // must be `var` (not `const`) because this can get embedded multiple times on a page
var toggleVisibility = (className) => {

    const elements = document.querySelectorAll(`.${className}`);

    elements.forEach(element => {
        if (element.classList.contains("mne-repr-section-header")) {
            return  // Don't collapse the section header row
        }
        element.classList.toggle("mne-repr-collapsed");
    });

    // trigger caret to rotate
    var sel = `.mne-repr-section-header.${className} > th.mne-repr-section-toggle > button`;
    const button = document.querySelector(sel);
    button.classList.toggle("collapsed");

    // adjust tooltip
    sel = `tr.mne-repr-section-header.${className}`;
    const secHeadRow = document.querySelector(sel);
    secHeadRow.classList.toggle("collapsed");
    secHeadRow.title = secHeadRow.title === "Hide section" ? "Show section" : "Hide section";
}
</script>

<style type="text/css">
    /*
Styles in this section apply both to the sphinx-built website docs and to notebooks
rendered in an IDE or in Jupyter. In our web docs, styles here are complemented by
doc/_static/styles.css and other CSS files (e.g. from the sphinx theme, sphinx-gallery,
or bootstrap). In IDEs/Jupyter, those style files are unavailable, so only the rules in
this file apply (plus whatever default styling the IDE applies).
*/
.mne-repr-table {
    display: inline;  /* prevent using full container width */
}
.mne-repr-table tr.mne-repr-section-header > th {
    padding-top: 1rem;
    text-align: left;
    vertical-align: middle;
}
.mne-repr-section-toggle > button {
    all: unset;
    display: block;
    height: 1rem;
    width: 1rem;
}
.mne-repr-section-toggle > button > svg {
    height: 60%;
}

/* transition (rotation) effects on the collapser button */
.mne-repr-section-toggle > button.collapsed > svg {
    transition: 0.1s ease-out;
    transform: rotate(-90deg);
}
.mne-repr-section-toggle > button:not(.collapsed) > svg {
    transition: 0.1s ease-out;
    transform: rotate(0deg);
}

/* hide collapsed table rows */
.mne-repr-collapsed {
    display: none;
}


@layer {
    /*
    Selectors in a `@layer` will always be lower-precedence than selectors outside the
    layer. So even though e.g. `div.output_html` is present in the sphinx-rendered
    website docs, the styles here won't take effect there as long as some other rule
    somewhere in the page's CSS targets the same element.

    In IDEs or Jupyter notebooks, though, the CSS files from the sphinx theme,
    sphinx-gallery, and bootstrap are unavailable, so these styles will apply.

    Notes:

    - the selector `.accordion-body` is for MNE Reports
    - the selector `.output_html` is for VSCode's notebook interface
    - the selector `.jp-RenderedHTML` is for Jupyter notebook
    - variables starting with `--theme-` are VSCode-specific.
    - variables starting with `--jp-` are Jupyter styles, *some of which* are also
      available in VSCode. Here we try the `--theme-` variable first, then fall back to
      the `--jp-` ones.
    */
    .mne-repr-table {
        --mne-toggle-color: var(--theme-foreground, var(--jp-ui-font-color1));
        --mne-button-bg-color: var(--theme-button-background, var(--jp-info-color0, var(--jp-content-link-color)));
        --mne-button-fg-color: var(--theme-button-foreground, var(--jp-ui-inverse-font-color0, var(--jp-editor-background)));
        --mne-button-hover-bg-color: var(--theme-button-hover-background, var(--jp-info-color1));
        --mne-button-radius: var(--jp-border-radius, 0.25rem);
    }
    /* chevron position/alignment; in VSCode it looks ok without adjusting */
    .accordion-body .mne-repr-section-toggle > button,
    .jp-RenderedHTML .mne-repr-section-toggle > button {
        padding: 0 0 45% 25% !important;
    }
    /* chevron color; MNE Report doesn't have light/dark mode */
    div.output_html .mne-repr-section-toggle > button > svg > path,
    .jp-RenderedHTML .mne-repr-section-toggle > button > svg > path {
        fill: var(--mne-toggle-color);
    }
    .accordion-body .mne-ch-names-btn,
    div.output_html .mne-ch-names-btn,
    .jp-RenderedHTML .mne-ch-names-btn {
        -webkit-border-radius: var(--mne-button-radius);
        -moz-border-radius: var(--mne-button-radius);
        border-radius: var(--mne-button-radius);
        border: none;
        background-image: none;
        background-color: var(--mne-button-bg-color);
        color: var(--mne-button-fg-color);
        font-size: inherit;
        min-width: 1.5rem;
        padding: 0.25rem;
        text-align: center;
        text-decoration: none;
    }
    .accordion-body .mne-ch-names-btn:hover,
    div.output_html .mne.ch-names-btn:hover,
    .jp-RenderedHTML .mne-ch-names-btn:hover {
        background-color: var(--mne-button-hover-bg-color);
        text-decoration: underline;
    }
    .accordion-body .mne-ch-names-btn:focus-visible,
    div.output_html .mne-ch-names-btn:focus-visible,
    .jp-RenderedHTML .mne-ch-names-btn:focus-visible {
        outline: 0.1875rem solid var(--mne-button-bg-color) !important;
        outline-offset: 0.1875rem !important;
    }
}
</style>



<table class="table mne-repr-table">








<tr class="mne-repr-section-header general-34904d76-662e-49cf-8f9f-b3260669f4b4"
     title="Hide section"
    onclick="toggleVisibility('general-34904d76-662e-49cf-8f9f-b3260669f4b4')">
    <th class="mne-repr-section-toggle">
        <button >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M233.4 406.6c12.5 12.5 32.8 12.5 45.3 0l192-192c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L256 338.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l192 192z"/></svg>
        </button>
    </th>
    <th colspan="2">
        <strong>General</strong>
    </th>
</tr>


<tr class="repr-element general-34904d76-662e-49cf-8f9f-b3260669f4b4 ">
    <td class="mne-repr-section-toggle"></td>
    <td>Filename(s)</td>
    <td>

        sample_subject_oddball.eeg


    </td>
</tr>

<tr class="repr-element general-34904d76-662e-49cf-8f9f-b3260669f4b4 ">
    <td class="mne-repr-section-toggle"></td>
    <td>MNE object type</td>
    <td>RawBrainVision</td>
</tr>
<tr class="repr-element general-34904d76-662e-49cf-8f9f-b3260669f4b4 ">
    <td class="mne-repr-section-toggle"></td>
    <td>Measurement date</td>

    <td>2018-10-31 at 11:19:57 UTC</td>

</tr>
<tr class="repr-element general-34904d76-662e-49cf-8f9f-b3260669f4b4 ">
    <td class="mne-repr-section-toggle"></td>
    <td>Participant</td>

    <td>Unknown</td>

</tr>
<tr class="repr-element general-34904d76-662e-49cf-8f9f-b3260669f4b4 ">
    <td class="mne-repr-section-toggle"></td>
    <td>Experimenter</td>

    <td>Unknown</td>

</tr>








<tr class="mne-repr-section-header acquisition-a824e2e4-12f9-4e1f-ada8-156cbfd3ceaa"
     title="Hide section"
    onclick="toggleVisibility('acquisition-a824e2e4-12f9-4e1f-ada8-156cbfd3ceaa')">
    <th class="mne-repr-section-toggle">
        <button >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M233.4 406.6c12.5 12.5 32.8 12.5 45.3 0l192-192c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L256 338.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l192 192z"/></svg>
        </button>
    </th>
    <th colspan="2">
        <strong>Acquisition</strong>
    </th>
</tr>


<tr class="repr-element acquisition-a824e2e4-12f9-4e1f-ada8-156cbfd3ceaa ">
    <td class="mne-repr-section-toggle"></td>
    <td>Duration</td>
    <td>00:22:10 (HH:MM:SS)</td>
</tr>








<tr class="repr-element acquisition-a824e2e4-12f9-4e1f-ada8-156cbfd3ceaa ">
    <td class="mne-repr-section-toggle"></td>
    <td>Sampling frequency</td>
    <td>1000.00 Hz</td>
</tr>


<tr class="repr-element acquisition-a824e2e4-12f9-4e1f-ada8-156cbfd3ceaa ">
    <td class="mne-repr-section-toggle"></td>
    <td>Time points</td>
    <td>1,329,200</td>
</tr>










<tr class="mne-repr-section-header channels-7940349a-350d-4b7f-b2aa-7888cfe6d408"
     title="Hide section"
    onclick="toggleVisibility('channels-7940349a-350d-4b7f-b2aa-7888cfe6d408')">
    <th class="mne-repr-section-toggle">
        <button >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M233.4 406.6c12.5 12.5 32.8 12.5 45.3 0l192-192c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L256 338.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l192 192z"/></svg>
        </button>
    </th>
    <th colspan="2">
        <strong>Channels</strong>
    </th>
</tr>



<tr class="repr-element channels-7940349a-350d-4b7f-b2aa-7888cfe6d408 ">
    <td class="mne-repr-section-toggle"></td>
    <td>EEG</td>
    <td>
        <button class="mne-ch-names-btn sd-sphinx-override sd-btn sd-btn-info sd-text-wrap sd-shadow-sm" onclick="alert('Good EEG:\n\nFp1, Fz, F3, F7, FT9, FC5, FC1, C3, T7, TP9, CP5, CP1, Pz, P3, P7, O1, Oz, O2, P4, P8, TP10, CP6, CP2, Cz, C4, T8, FT10, FC6, FC2, F4, F8, Fp2, AF7, AF3, AFz, F1, F5, FT7, FC3, C1, C5, TP7, CP3, P1, P5, PO7, PO3, POz, PO4, PO8, P6, P2, CPz, CP4, TP8, C6, C2, FC4, FT8, F6, AF8, AF4, F2, F9, AFF1h, FFC1h, FFC5h, FTT7h, FCC3h, CCP1h, CCP5h, TPP7h, P9, PPO9h, PO9, O9, OI1h, PPO1h, CPP3h, CPP4h, PPO2h, OI2h, O10, PO10, PPO10h, P10, TPP8h, CCP6h, CCP2h, FCC4h, FTT8h, FFC6h, FFC2h, AFF2h, F10, AFp1, AFF5h, FFT9h, FFT7h, FFC3h, FCC1h, FCC5h, FTT9h, TTP7h, CCP3h, CPP1h, CPP5h, TPP9h, POO9h, PPO5h, POO1, POO2, PPO6h, POO10h, TPP10h, CPP6h, CPP2h, CCP4h, TTP8h, FTT10h, FCC6h, FCC2h, FFC4h, FFT8h, FFT10h, AFF6h, AFp2')" title="(Click to open in popup)&#13;&#13;Fp1, Fz, F3, F7, FT9, FC5, FC1, C3, T7, TP9, CP5, CP1, Pz, P3, P7, O1, Oz, O2, P4, P8, TP10, CP6, CP2, Cz, C4, T8, FT10, FC6, FC2, F4, F8, Fp2, AF7, AF3, AFz, F1, F5, FT7, FC3, C1, C5, TP7, CP3, P1, P5, PO7, PO3, POz, PO4, PO8, P6, P2, CPz, CP4, TP8, C6, C2, FC4, FT8, F6, AF8, AF4, F2, F9, AFF1h, FFC1h, FFC5h, FTT7h, FCC3h, CCP1h, CCP5h, TPP7h, P9, PPO9h, PO9, O9, OI1h, PPO1h, CPP3h, CPP4h, PPO2h, OI2h, O10, PO10, PPO10h, P10, TPP8h, CCP6h, CCP2h, FCC4h, FTT8h, FFC6h, FFC2h, AFF2h, F10, AFp1, AFF5h, FFT9h, FFT7h, FFC3h, FCC1h, FCC5h, FTT9h, TTP7h, CCP3h, CPP1h, CPP5h, TPP9h, POO9h, PPO5h, POO1, POO2, PPO6h, POO10h, TPP10h, CPP6h, CPP2h, CCP4h, TTP8h, FTT10h, FCC6h, FCC2h, FFC4h, FFT8h, FFT10h, AFF6h, AFp2">
            127
        </button>


    </td>
</tr>


<tr class="repr-element channels-7940349a-350d-4b7f-b2aa-7888cfe6d408 ">
    <td class="mne-repr-section-toggle"></td>
    <td>Head & sensor digitization</td>

    <td>130 points</td>

</tr>








<tr class="mne-repr-section-header filters-4ab80219-dde2-4250-a9ac-431d535cb311"
     title="Hide section"
    onclick="toggleVisibility('filters-4ab80219-dde2-4250-a9ac-431d535cb311')">
    <th class="mne-repr-section-toggle">
        <button >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M233.4 406.6c12.5 12.5 32.8 12.5 45.3 0l192-192c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L256 338.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l192 192z"/></svg>
        </button>
    </th>
    <th colspan="2">
        <strong>Filters</strong>
    </th>
</tr>


<tr class="repr-element filters-4ab80219-dde2-4250-a9ac-431d535cb311 ">
    <td class="mne-repr-section-toggle"></td>
    <td>Highpass</td>
    <td>0.00 Hz</td>
</tr>


<tr class="repr-element filters-4ab80219-dde2-4250-a9ac-431d535cb311 ">
    <td class="mne-repr-section-toggle"></td>
    <td>Lowpass</td>
    <td>280.00 Hz</td>
</tr>


</table></div>
</div>
</section>
</section>
<section id="4.-Filtering-and-Artifact-Detection">
<h2>4. Filtering and Artifact Detection<a class="headerlink" href="#4.-Filtering-and-Artifact-Detection" title="Link to this heading">#</a></h2>
<p>Now we begin the core cleaning process. The order of operations here is important.</p>
<section id="High-Pass-Filtering">
<h3>High-Pass Filtering<a class="headerlink" href="#High-Pass-Filtering" title="Link to this heading">#</a></h3>
<p>We start with a <strong>high-pass filter</strong> to remove slow drifts in the data. These drifts can be caused by sweat, skin potentials, or slow electrode movement. A cutoff of 1 Hz is common for ERP analysis, as it effectively removes these drifts while preserving the faster neural signals of interest.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># High-Pass Filtering (&gt;1 Hz)</span>
<span class="n">raw</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">l_freq</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">h_freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;fir&#39;</span><span class="p">,</span> <span class="n">fir_window</span><span class="o">=</span><span class="s1">&#39;hamming&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Filtering raw data in 1 contiguous segment
Setting up high-pass filter at 1 Hz

FIR filter parameters
---------------------
Designing a one-pass, zero-phase, non-causal highpass filter:
- Windowed time-domain design (firwin) method
- Hamming window with 0.0194 passband ripple and 53 dB stopband attenuation
- Lower passband edge: 1.00
- Lower transition bandwidth: 1.00 Hz (-6 dB cutoff frequency: 0.50 Hz)
- Filter length: 3301 samples (3.301 s)
</pre></div></div>
</div>
</section>
<section id="Automated-Bad-Channel-and-Segment-Detection">
<h3>Automated Bad Channel and Segment Detection<a class="headerlink" href="#Automated-Bad-Channel-and-Segment-Detection" title="Link to this heading">#</a></h3>
<p>Next, we identify and mark bad data. This is a two-step process using custom utility functions, which are often developed in a lab to standardize analysis.</p>
<ol class="arabic simple">
<li><p><strong>``rejchanspec`` (Reject Channel by Spectrum)</strong>: This function identifies channels with abnormal spectral power. The <code class="docutils literal notranslate"><span class="pre">freqlims</span></code> parameter defines the frequency bands to examine, while <code class="docutils literal notranslate"><span class="pre">stdlims</span></code> sets the corresponding standard deviation (Z-score) thresholds. For example, a channel is marked as bad if its power within a given band exceeds the specified threshold. The names of these bad channels are then added to the <code class="docutils literal notranslate"><span class="pre">raw.info['bads']</span></code> list.</p></li>
<li><p><strong>``trimoutlier`` (Trim Outliers)</strong>: This function detects and marks time segments containing extreme voltage fluctuations, such as those caused by subject movement. The <code class="docutils literal notranslate"><span class="pre">amplitude_threshold</span></code> parameter sets the absolute voltage value (e.g., 500 ¬µV) above which a data point is considered an artifact. The <code class="docutils literal notranslate"><span class="pre">point_spread_width</span></code> parameter then marks a time window (in milliseconds) around any detected artifact as ‚Äúbad.‚Äù This padding ensures that the artifact‚Äôs onset and offset are also fully
excluded from subsequent analyses. The function creates <strong>annotations</strong> that label these identified periods as ‚Äúbad.‚Äù MNE functions can then be instructed to ignore these segments during later steps like ICA.</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove Bad Channels Using REJCHANSPEC</span>
<span class="n">freqlims</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">5.00</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">5.00</span><span class="p">,</span> <span class="mf">40.00</span><span class="p">]]</span>
<span class="n">stdlims</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mf">5.00</span><span class="p">,</span> <span class="mf">5.00</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">2.50</span><span class="p">,</span>  <span class="mf">2.50</span><span class="p">]]</span>
<span class="n">raw</span><span class="p">,</span> <span class="n">specdata</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">rejchanspec</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">freqlims</span><span class="p">,</span> <span class="n">stdlims</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Removed EEG channels: [&#39;FCC1h&#39;, &#39;Fz&#39;, &#39;FC1&#39;, &#39;FCC2h&#39;, &#39;Cz&#39;, &#39;FFC1h&#39;, &#39;FFC2h&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove Bad Samples Using TRIMOUTLIER</span>

<span class="n">amplitude_threshold</span> <span class="o">=</span> <span class="mi">500</span><span class="o">*</span><span class="mf">1e-6</span>
<span class="n">point_spread_width</span> <span class="o">=</span> <span class="mi">2000</span> <span class="c1"># ms</span>

<span class="n">raw</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">trimoutlier</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">amplitude_threshold</span><span class="p">,</span> <span class="n">point_spread_width</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Selected 120 EEG channels (excluding bads)
No channel removed.

0.0005uV threshold with 2000ms spreading rejected 20.4 sec data, added 9 boundaries.
trimOutlier done. The masks for clean channels and data points are stored in the raw object.
</pre></div></div>
</div>
</section>
<section id="Low-Pass-Filtering-(for-ICA)">
<h3>Low-Pass Filtering (for ICA)<a class="headerlink" href="#Low-Pass-Filtering-(for-ICA)" title="Link to this heading">#</a></h3>
<p>Before running ICA, it‚Äôs good practice to <strong>low-pass filter</strong> the data. High-frequency noise (like muscle activity) can sometimes dominate the signal and prevent ICA from finding a good solution. We apply a 100 Hz low-pass filter here to clean up the signal specifically for the ICA decomposition. We will apply a stricter low-pass filter later for our final analysis.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Low-Pass Filtering (&lt;100 Hz)</span>
<span class="n">raw</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">l_freq</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">h_freq</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;fir&#39;</span><span class="p">,</span> <span class="n">fir_window</span><span class="o">=</span><span class="s1">&#39;hamming&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Filtering raw data in 1 contiguous segment
Setting up low-pass filter at 1e+02 Hz

FIR filter parameters
---------------------
Designing a one-pass, zero-phase, non-causal lowpass filter:
- Windowed time-domain design (firwin) method
- Hamming window with 0.0194 passband ripple and 53 dB stopband attenuation
- Upper passband edge: 100.00 Hz
- Upper transition bandwidth: 25.00 Hz (-6 dB cutoff frequency: 112.50 Hz)
- Filter length: 133 samples (0.133 s)
</pre></div></div>
</div>
</section>
</section>
<section id="5.-Rereferencing">
<h2>5. Rereferencing<a class="headerlink" href="#5.-Rereferencing" title="Link to this heading">#</a></h2>
<p>The voltage at any one electrode is measured relative to a reference. Here, the data was recorded with <code class="docutils literal notranslate"><span class="pre">FCz</span></code> as a reference electrode. We can bring it back to the analysis and rereference to the <strong>average of all EEG channels</strong>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Bring back FCz channel</span>
<span class="n">raw</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">add_reference_channels</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="s1">&#39;FCz&#39;</span><span class="p">)</span>
<span class="n">raw</span><span class="o">.</span><span class="n">set_montage</span><span class="p">(</span><span class="n">montage</span><span class="p">)</span>

<span class="c1"># Re-reference to average reference</span>
<span class="n">raw</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">set_eeg_reference</span><span class="p">(</span><span class="n">ref_channels</span><span class="o">=</span><span class="s2">&quot;average&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
EEG channel type selected for re-referencing
Applying average reference.
Applying a custom (&#39;EEG&#39;,) reference.
</pre></div></div>
</div>
</section>
<section id="6.-Independent-Component-Analysis-(ICA)-for-Artifact-Removal">
<h2>6. Independent Component Analysis (ICA) for Artifact Removal<a class="headerlink" href="#6.-Independent-Component-Analysis-(ICA)-for-Artifact-Removal" title="Link to this heading">#</a></h2>
<p><strong>ICA</strong> is a technique for separating statistically independent signals that have been mixed together. In EEG, it‚Äôs effective at isolating stereotyped artifacts like:</p>
<ul class="simple">
<li><p>Eye blinks and eye movements</p></li>
<li><p>Heartbeat signals (ECG)</p></li>
<li><p>Persistent muscle tension</p></li>
</ul>
<p>The process is:</p>
<ol class="arabic simple">
<li><p><strong>Fit ICA</strong>: We decompose the EEG signal into a set of independent components (ICs). We do this only on the ‚Äúgood‚Äù data segments, using <code class="docutils literal notranslate"><span class="pre">reject_by_annotation=True</span></code>.</p></li>
<li><p><strong>Label Components</strong>: We use the <code class="docutils literal notranslate"><span class="pre">mne-icalabel</span></code> library to automatically classify each IC into categories like brain, eye blink, muscle, etc. For the best performance, <strong>``ICLabel`` requires data that is average-referenced, filtered between 1-100 Hz, and decomposed using an ``extended infomax`` ICA</strong>. We have explicitly followed these steps in our pipeline, which justifies our earlier preprocessing choices and the ICA settings we are about to use.</p></li>
<li><p><strong>Remove Artifactual Components</strong>: We identify the ICs that were confidently labeled as artifacts (e.g., ‚Äúeye blink‚Äù) and instruct MNE to remove them.</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ICA</span>
<span class="n">chans_to_pick</span> <span class="o">=</span> <span class="p">[</span><span class="n">chan</span> <span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span> <span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;ch_names&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">chan</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;bads&#39;</span><span class="p">]]</span>
<span class="n">rank</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">matrix_rank</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">reject_by_annotation</span><span class="o">=</span><span class="s1">&#39;omit&#39;</span><span class="p">,</span> <span class="n">picks</span><span class="o">=</span><span class="n">chans_to_pick</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

<span class="n">ica</span> <span class="o">=</span> <span class="n">ICA</span><span class="p">(</span>
    <span class="n">n_components</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span>
    <span class="n">max_iter</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;infomax&quot;</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">692</span><span class="p">,</span>
    <span class="n">fit_params</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">extended</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">ica</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">reject</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reject_by_annotation</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Classify components using mne-iclabel</span>
<span class="n">ic_labels</span> <span class="o">=</span> <span class="n">label_components</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">ica</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;iclabel&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Omitting 20454 of 1329200 (1.54%) samples, retaining 1308746 (98.46%) samples.
Fitting ICA to data using 121 channels (please be patient, this may take a while)
Omitting 20454 of 1329200 (1.54%) samples, retaining 1308746 (98.46%) samples.
Selecting by number: 120 components
Computing Extended Infomax ICA
Fitting ICA took 1790.4s.
</pre></div></div>
</div>
<p>We can visually inspect identified components. The code below first selects the components that were labeled as ‚Äúeye blink‚Äù with high confidence (over 75%). Then, it generates two types of plots for our inspection:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">plot_properties()</span></code>: A detailed summary, including the component‚Äôs <strong>scalp topography</strong> (which should be frontal for blinks) and frequency spectrum.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plot_sources()</span></code>: The component‚Äôs <strong>activity over time</strong>, which should show the characteristic sharp peaks of eye blinks.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ## OPTIONAL: inspect conponents</span>
<span class="c1"># idxs = [idx for idx, (label, proba) in enumerate(zip(ic_labels[&quot;labels&quot;],ic_labels[&#39;y_pred_proba&#39;])) if label in [&quot;eye blink&quot;] and proba &gt; 0.75]</span>
<span class="c1"># ica.plot_properties(raw, picks=idxs, verbose=False)</span>
<span class="c1"># ica.plot_sources(raw, picks=idxs)</span>
<br/></pre></div>
</div>
</div>
<p>The following code creates a list of component indices to <code class="docutils literal notranslate"><span class="pre">exclude_idx</span></code>. It identifies any component whose label is <em>not</em> <code class="docutils literal notranslate"><span class="pre">&quot;brain&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;other&quot;</span></code> and has a prediction probability greater than ****75%****. Finally, <code class="docutils literal notranslate"><span class="pre">ica.apply()</span></code> removes the activity from these selected components, cleaning the underlying EEG data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><br/><span></span><span class="n">labels</span> <span class="o">=</span> <span class="n">ic_labels</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span> <span class="c1"># predicted labels</span>
<span class="n">probas</span> <span class="o">=</span> <span class="n">ic_labels</span><span class="p">[</span><span class="s1">&#39;y_pred_proba&#39;</span><span class="p">]</span> <span class="c1"># probabilities for each component to be the labelled class</span>

<span class="c1"># exclude components if the labelled component is not brain or other and the corresponding probability of artifact component is at least 0.75</span>
<span class="n">exclude_idx</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">proba</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">probas</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;brain&quot;</span><span class="p">,</span> <span class="s2">&quot;other&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">proba</span> <span class="o">&gt;</span> <span class="mf">0.75</span>
<span class="p">]</span>

<span class="n">ica</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude_idx</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Applying ICA to Raw instance
    Transforming to ICA space (120 components)
    Zeroing out 34 ICA components
    Projecting back using 121 PCA components
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<script type="text/javascript">
    // must be `var` (not `const`) because this can get embedded multiple times on a page
var toggleVisibility = (className) => {

    const elements = document.querySelectorAll(`.${className}`);

    elements.forEach(element => {
        if (element.classList.contains("mne-repr-section-header")) {
            return  // Don't collapse the section header row
        }
        element.classList.toggle("mne-repr-collapsed");
    });

    // trigger caret to rotate
    var sel = `.mne-repr-section-header.${className} > th.mne-repr-section-toggle > button`;
    const button = document.querySelector(sel);
    button.classList.toggle("collapsed");

    // adjust tooltip
    sel = `tr.mne-repr-section-header.${className}`;
    const secHeadRow = document.querySelector(sel);
    secHeadRow.classList.toggle("collapsed");
    secHeadRow.title = secHeadRow.title === "Hide section" ? "Show section" : "Hide section";
}
</script>

<style type="text/css">
    /*
Styles in this section apply both to the sphinx-built website docs and to notebooks
rendered in an IDE or in Jupyter. In our web docs, styles here are complemented by
doc/_static/styles.css and other CSS files (e.g. from the sphinx theme, sphinx-gallery,
or bootstrap). In IDEs/Jupyter, those style files are unavailable, so only the rules in
this file apply (plus whatever default styling the IDE applies).
*/
.mne-repr-table {
    display: inline;  /* prevent using full container width */
}
.mne-repr-table tr.mne-repr-section-header > th {
    padding-top: 1rem;
    text-align: left;
    vertical-align: middle;
}
.mne-repr-section-toggle > button {
    all: unset;
    display: block;
    height: 1rem;
    width: 1rem;
}
.mne-repr-section-toggle > button > svg {
    height: 60%;
}

/* transition (rotation) effects on the collapser button */
.mne-repr-section-toggle > button.collapsed > svg {
    transition: 0.1s ease-out;
    transform: rotate(-90deg);
}
.mne-repr-section-toggle > button:not(.collapsed) > svg {
    transition: 0.1s ease-out;
    transform: rotate(0deg);
}

/* hide collapsed table rows */
.mne-repr-collapsed {
    display: none;
}


@layer {
    /*
    Selectors in a `@layer` will always be lower-precedence than selectors outside the
    layer. So even though e.g. `div.output_html` is present in the sphinx-rendered
    website docs, the styles here won't take effect there as long as some other rule
    somewhere in the page's CSS targets the same element.

    In IDEs or Jupyter notebooks, though, the CSS files from the sphinx theme,
    sphinx-gallery, and bootstrap are unavailable, so these styles will apply.

    Notes:

    - the selector `.accordion-body` is for MNE Reports
    - the selector `.output_html` is for VSCode's notebook interface
    - the selector `.jp-RenderedHTML` is for Jupyter notebook
    - variables starting with `--theme-` are VSCode-specific.
    - variables starting with `--jp-` are Jupyter styles, *some of which* are also
      available in VSCode. Here we try the `--theme-` variable first, then fall back to
      the `--jp-` ones.
    */
    .mne-repr-table {
        --mne-toggle-color: var(--theme-foreground, var(--jp-ui-font-color1));
        --mne-button-bg-color: var(--theme-button-background, var(--jp-info-color0, var(--jp-content-link-color)));
        --mne-button-fg-color: var(--theme-button-foreground, var(--jp-ui-inverse-font-color0, var(--jp-editor-background)));
        --mne-button-hover-bg-color: var(--theme-button-hover-background, var(--jp-info-color1));
        --mne-button-radius: var(--jp-border-radius, 0.25rem);
    }
    /* chevron position/alignment; in VSCode it looks ok without adjusting */
    .accordion-body .mne-repr-section-toggle > button,
    .jp-RenderedHTML .mne-repr-section-toggle > button {
        padding: 0 0 45% 25% !important;
    }
    /* chevron color; MNE Report doesn't have light/dark mode */
    div.output_html .mne-repr-section-toggle > button > svg > path,
    .jp-RenderedHTML .mne-repr-section-toggle > button > svg > path {
        fill: var(--mne-toggle-color);
    }
    .accordion-body .mne-ch-names-btn,
    div.output_html .mne-ch-names-btn,
    .jp-RenderedHTML .mne-ch-names-btn {
        -webkit-border-radius: var(--mne-button-radius);
        -moz-border-radius: var(--mne-button-radius);
        border-radius: var(--mne-button-radius);
        border: none;
        background-image: none;
        background-color: var(--mne-button-bg-color);
        color: var(--mne-button-fg-color);
        font-size: inherit;
        min-width: 1.5rem;
        padding: 0.25rem;
        text-align: center;
        text-decoration: none;
    }
    .accordion-body .mne-ch-names-btn:hover,
    div.output_html .mne.ch-names-btn:hover,
    .jp-RenderedHTML .mne-ch-names-btn:hover {
        background-color: var(--mne-button-hover-bg-color);
        text-decoration: underline;
    }
    .accordion-body .mne-ch-names-btn:focus-visible,
    div.output_html .mne-ch-names-btn:focus-visible,
    .jp-RenderedHTML .mne-ch-names-btn:focus-visible {
        outline: 0.1875rem solid var(--mne-button-bg-color) !important;
        outline-offset: 0.1875rem !important;
    }
}
</style>



<table class="table mne-repr-table">








<tr class="mne-repr-section-header general-e21d740f-496e-42d1-8d68-e800d813635e"
     title="Hide section"
    onclick="toggleVisibility('general-e21d740f-496e-42d1-8d68-e800d813635e')">
    <th class="mne-repr-section-toggle">
        <button >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M233.4 406.6c12.5 12.5 32.8 12.5 45.3 0l192-192c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L256 338.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l192 192z"/></svg>
        </button>
    </th>
    <th colspan="2">
        <strong>General</strong>
    </th>
</tr>


<tr class="repr-element general-e21d740f-496e-42d1-8d68-e800d813635e ">
    <td class="mne-repr-section-toggle"></td>
    <td>Filename(s)</td>
    <td>

        sample_subject_oddball.eeg


    </td>
</tr>

<tr class="repr-element general-e21d740f-496e-42d1-8d68-e800d813635e ">
    <td class="mne-repr-section-toggle"></td>
    <td>MNE object type</td>
    <td>RawBrainVision</td>
</tr>
<tr class="repr-element general-e21d740f-496e-42d1-8d68-e800d813635e ">
    <td class="mne-repr-section-toggle"></td>
    <td>Measurement date</td>

    <td>2018-10-31 at 11:19:57 UTC</td>

</tr>
<tr class="repr-element general-e21d740f-496e-42d1-8d68-e800d813635e ">
    <td class="mne-repr-section-toggle"></td>
    <td>Participant</td>

    <td>Unknown</td>

</tr>
<tr class="repr-element general-e21d740f-496e-42d1-8d68-e800d813635e ">
    <td class="mne-repr-section-toggle"></td>
    <td>Experimenter</td>

    <td>Unknown</td>

</tr>








<tr class="mne-repr-section-header acquisition-d0e040f2-153d-4bc0-8297-1b05a1f042d3"
     title="Hide section"
    onclick="toggleVisibility('acquisition-d0e040f2-153d-4bc0-8297-1b05a1f042d3')">
    <th class="mne-repr-section-toggle">
        <button >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M233.4 406.6c12.5 12.5 32.8 12.5 45.3 0l192-192c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L256 338.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l192 192z"/></svg>
        </button>
    </th>
    <th colspan="2">
        <strong>Acquisition</strong>
    </th>
</tr>


<tr class="repr-element acquisition-d0e040f2-153d-4bc0-8297-1b05a1f042d3 ">
    <td class="mne-repr-section-toggle"></td>
    <td>Duration</td>
    <td>00:22:10 (HH:MM:SS)</td>
</tr>








<tr class="repr-element acquisition-d0e040f2-153d-4bc0-8297-1b05a1f042d3 ">
    <td class="mne-repr-section-toggle"></td>
    <td>Sampling frequency</td>
    <td>1000.00 Hz</td>
</tr>


<tr class="repr-element acquisition-d0e040f2-153d-4bc0-8297-1b05a1f042d3 ">
    <td class="mne-repr-section-toggle"></td>
    <td>Time points</td>
    <td>1,329,200</td>
</tr>










<tr class="mne-repr-section-header channels-49458bed-1315-4d3f-b3d3-6d84ac4004eb"
     title="Hide section"
    onclick="toggleVisibility('channels-49458bed-1315-4d3f-b3d3-6d84ac4004eb')">
    <th class="mne-repr-section-toggle">
        <button >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M233.4 406.6c12.5 12.5 32.8 12.5 45.3 0l192-192c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L256 338.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l192 192z"/></svg>
        </button>
    </th>
    <th colspan="2">
        <strong>Channels</strong>
    </th>
</tr>



<tr class="repr-element channels-49458bed-1315-4d3f-b3d3-6d84ac4004eb ">
    <td class="mne-repr-section-toggle"></td>
    <td>EEG</td>
    <td>
        <button class="mne-ch-names-btn sd-sphinx-override sd-btn sd-btn-info sd-text-wrap sd-shadow-sm" onclick="alert('Good EEG:\n\nFp1, F3, F7, FT9, FC5, C3, T7, TP9, CP5, CP1, Pz, P3, P7, O1, Oz, O2, P4, P8, TP10, CP6, CP2, C4, T8, FT10, FC6, FC2, F4, F8, Fp2, AF7, AF3, AFz, F1, F5, FT7, FC3, C1, C5, TP7, CP3, P1, P5, PO7, PO3, POz, PO4, PO8, P6, P2, CPz, CP4, TP8, C6, C2, FC4, FT8, F6, AF8, AF4, F2, F9, AFF1h, FFC5h, FTT7h, FCC3h, CCP1h, CCP5h, TPP7h, P9, PPO9h, PO9, O9, OI1h, PPO1h, CPP3h, CPP4h, PPO2h, OI2h, O10, PO10, PPO10h, P10, TPP8h, CCP6h, CCP2h, FCC4h, FTT8h, FFC6h, AFF2h, F10, AFp1, AFF5h, FFT9h, FFT7h, FFC3h, FCC5h, FTT9h, TTP7h, CCP3h, CPP1h, CPP5h, TPP9h, POO9h, PPO5h, POO1, POO2, PPO6h, POO10h, TPP10h, CPP6h, CPP2h, CCP4h, TTP8h, FTT10h, FCC6h, FFC4h, FFT8h, FFT10h, AFF6h, AFp2, FCz')" title="(Click to open in popup)&#13;&#13;Fp1, F3, F7, FT9, FC5, C3, T7, TP9, CP5, CP1, Pz, P3, P7, O1, Oz, O2, P4, P8, TP10, CP6, CP2, C4, T8, FT10, FC6, FC2, F4, F8, Fp2, AF7, AF3, AFz, F1, F5, FT7, FC3, C1, C5, TP7, CP3, P1, P5, PO7, PO3, POz, PO4, PO8, P6, P2, CPz, CP4, TP8, C6, C2, FC4, FT8, F6, AF8, AF4, F2, F9, AFF1h, FFC5h, FTT7h, FCC3h, CCP1h, CCP5h, TPP7h, P9, PPO9h, PO9, O9, OI1h, PPO1h, CPP3h, CPP4h, PPO2h, OI2h, O10, PO10, PPO10h, P10, TPP8h, CCP6h, CCP2h, FCC4h, FTT8h, FFC6h, AFF2h, F10, AFp1, AFF5h, FFT9h, FFT7h, FFC3h, FCC5h, FTT9h, TTP7h, CCP3h, CPP1h, CPP5h, TPP9h, POO9h, PPO5h, POO1, POO2, PPO6h, POO10h, TPP10h, CPP6h, CPP2h, CCP4h, TTP8h, FTT10h, FCC6h, FFC4h, FFT8h, FFT10h, AFF6h, AFp2, FCz">
            121
        </button>



        and <button class="mne-ch-names-btn sd-sphinx-override sd-btn sd-btn-info sd-text-wrap sd-shadow-sm" onclick="alert('Bad EEG:\n\nFz, FC1, Cz, FFC1h, FFC2h, FCC1h, FCC2h')" title="(Click to open in popup)&#13;&#13;Fz, FC1, Cz, FFC1h, FFC2h, FCC1h, FCC2h">
            7 bad
        </button>

    </td>
</tr>


<tr class="repr-element channels-49458bed-1315-4d3f-b3d3-6d84ac4004eb ">
    <td class="mne-repr-section-toggle"></td>
    <td>Head & sensor digitization</td>

    <td>131 points</td>

</tr>








<tr class="mne-repr-section-header filters-ce669b8a-807a-4112-8202-d980ba1c6e1f"
     title="Hide section"
    onclick="toggleVisibility('filters-ce669b8a-807a-4112-8202-d980ba1c6e1f')">
    <th class="mne-repr-section-toggle">
        <button >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M233.4 406.6c12.5 12.5 32.8 12.5 45.3 0l192-192c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L256 338.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l192 192z"/></svg>
        </button>
    </th>
    <th colspan="2">
        <strong>Filters</strong>
    </th>
</tr>


<tr class="repr-element filters-ce669b8a-807a-4112-8202-d980ba1c6e1f ">
    <td class="mne-repr-section-toggle"></td>
    <td>Highpass</td>
    <td>1.00 Hz</td>
</tr>


<tr class="repr-element filters-ce669b8a-807a-4112-8202-d980ba1c6e1f ">
    <td class="mne-repr-section-toggle"></td>
    <td>Lowpass</td>
    <td>100.00 Hz</td>
</tr>


</table></div>
</div>
</section>
<section id="7.-Final-Processing-Steps">
<h2>7. Final Processing Steps<a class="headerlink" href="#7.-Final-Processing-Steps" title="Link to this heading">#</a></h2>
<p>With the major artifacts removed, we can perform the final steps to get the data ready for epoching.</p>
<section id="Final-Low-Pass-Filter">
<h3>Final Low-Pass Filter<a class="headerlink" href="#Final-Low-Pass-Filter" title="Link to this heading">#</a></h3>
<p>We now apply a stricter <strong>low-pass filter</strong>, typically around 40 Hz is enough for ERP analysis.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Low-Pass Filtering (&lt;40 Hz)</span>
<span class="n">raw</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">l_freq</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">h_freq</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;fir&#39;</span><span class="p">,</span> <span class="n">fir_window</span><span class="o">=</span><span class="s1">&#39;hamming&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Filtering raw data in 1 contiguous segment
Setting up low-pass filter at 40 Hz

FIR filter parameters
---------------------
Designing a one-pass, zero-phase, non-causal lowpass filter:
- Windowed time-domain design (firwin) method
- Hamming window with 0.0194 passband ripple and 53 dB stopband attenuation
- Upper passband edge: 40.00 Hz
- Upper transition bandwidth: 10.00 Hz (-6 dB cutoff frequency: 45.00 Hz)
- Filter length: 331 samples (0.331 s)
</pre></div></div>
</div>
</section>
<section id="Interpolate-Bad-Channels-and-Resample">
<h3>Interpolate Bad Channels and Resample<a class="headerlink" href="#Interpolate-Bad-Channels-and-Resample" title="Link to this heading">#</a></h3>
<p>Two final steps:</p>
<ol class="arabic simple">
<li><p><strong>Interpolation</strong>: Now that the data is clean, we can fill in the data for the channels we marked as ‚Äúbad‚Äù at the beginning. The <code class="docutils literal notranslate"><span class="pre">interpolate_bads()</span></code> function uses data from neighboring channels to estimate the signal at the bad locations. We then <code class="docutils literal notranslate"><span class="pre">reset_bads=True</span></code> as the channels have now been repaired.</p></li>
<li><p><strong>Resampling</strong>: Our original sampling rate was 1000 Hz. This is often higher than needed for ERP analysis. We <strong>downsample</strong> the data to 256 Hz. This significantly reduces the file size and computational load for subsequent steps, without losing important information (thanks to the Nyquist theorem and our 40 Hz low-pass filter).</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Interpolate Bad Channels</span>
<span class="n">raw</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">interpolate_bads</span><span class="p">(</span><span class="n">reset_bads</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;spline&#39;</span><span class="p">)</span>

<span class="c1"># Downsample to 256 Hz</span>
<span class="n">raw</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">sfreq</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Setting channel interpolation method to {&#39;eeg&#39;: &#39;spline&#39;}.
Interpolating bad channels.
    Automatic origin fit: head of radius 99.6 mm
Computing interpolation matrix from 121 sensor positions
Interpolating 7 sensors
</pre></div></div>
</div>
</section>
<section id="Final-Check-for-Artifacts-and-Saving">
<h3>Final Check for Artifacts and Saving<a class="headerlink" href="#Final-Check-for-Artifacts-and-Saving" title="Link to this heading">#</a></h3>
<p>As a final quality control check, we can run <code class="docutils literal notranslate"><span class="pre">trimoutlier</span></code> with a stricter threshold to catch any remaining artifacts. Finally, it‚Äôs excellent practice to <strong>save the preprocessed continuous data</strong>. We save it in MNE‚Äôs native <code class="docutils literal notranslate"><span class="pre">.fif</span></code> format.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Final checks for Bad Samples Using TRIMOUTLIER</span>
<span class="n">channel_sd_lower_bound</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
<span class="n">channel_sd_upper_bound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
<span class="n">amplitude_threshold</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="mf">1e-6</span>
<span class="n">point_spread_width</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1"># 2000</span>

<span class="n">raw</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">trimoutlier</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">amplitude_threshold</span><span class="p">,</span> <span class="n">point_spread_width</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Selected 128 EEG channels (excluding bads)
No channel removed.

9.999999999999999e-05uV threshold with 1000ms spreading rejected 4.3 sec data, added 4 boundaries.
trimOutlier done. The masks for clean channels and data points are stored in the raw object.
</pre></div></div>
</div>
<p>Let‚Äôs inspect the results of the preprocessing by plotting raw object data.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># raw.plot()</span>
</pre></div>
</div>
</div>
<p>Upon closer inspection, we can still see some smaller, transient artifacts that were not caught by the previous threshold (for example: muscle artifacts around 545s or 648s or increased slow wave activity related to tiredness around 457s). To ensure our data is as clean as possible, we will run the <code class="docutils literal notranslate"><span class="pre">trimoutlier</span></code> function one more time with a stricter rejection threshold.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">amplitude_threshold</span> <span class="o">=</span> <span class="mi">50</span><span class="o">*</span><span class="mf">1e-6</span>
<span class="n">point_spread_width</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1"># 2000</span>

<span class="n">raw</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">trimoutlier</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">amplitude_threshold</span><span class="p">,</span> <span class="n">point_spread_width</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Selected 128 EEG channels (excluding bads)
No channel removed.

4.9999999999999996e-05uV threshold with 1000ms spreading rejected 45.1 sec data, added 36 boundaries.
trimOutlier done. The masks for clean channels and data points are stored in the raw object.
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save the raw object data</span>
<span class="n">filepath_save</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">subjects_dir</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span><span class="s1">&#39;_eeg&#39;</span><span class="p">,</span><span class="s1">&#39;_pre&#39;</span><span class="p">)</span>
<span class="c1">#raw.save(join(filepath_save, filename.replace(&#39;.vhdr&#39;, &#39;_preprocessed_raw.fif&#39;)), overwrite=True)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="8.-Epoching-and-Baseline-Correction">
<h2>8. Epoching and Baseline Correction<a class="headerlink" href="#8.-Epoching-and-Baseline-Correction" title="Link to this heading">#</a></h2>
<p>The final step is to segment the continuous data into <strong>epochs</strong> (or trials) time-locked to the events of interest in our oddball paradigm.</p>
<ul class="simple">
<li><p><strong>Extract Events</strong>: We first parse the event markers (annotations) from the raw data, mapping the trigger codes (e.g., ‚ÄòS 5‚Äô) to meaningful condition names (<code class="docutils literal notranslate"><span class="pre">standard</span></code>, <code class="docutils literal notranslate"><span class="pre">deviant</span></code>, <code class="docutils literal notranslate"><span class="pre">target</span></code>).</p></li>
<li><p><strong>Create Epochs</strong>: We then slice the data from -200 ms before each event to 800 ms after.</p></li>
<li><p><strong>Baseline Correction</strong>: For each epoch, we calculate the average signal in the pre-stimulus period (-200 ms to 0 ms) and subtract this average from the entire epoch. This ensures that any differences we see after the stimulus are not due to random fluctuations from before the stimulus appeared.</p></li>
<li><p><strong>Drop Bad Epochs</strong>: Any epochs that overlap with time periods we previously marked as ‚Äúbad‚Äù are automatically discarded using <code class="docutils literal notranslate"><span class="pre">reject_by_annotation=True</span></code>.</p></li>
</ul>
<p>The result is an <code class="docutils literal notranslate"><span class="pre">Epochs</span></code> object, which is the final, analysis-ready data structure. We save this object to a file for the next stage of analysis.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Divide data into epochs with DC detrend and -0.2 - 0s baseline correction</span>
<span class="n">all_events</span><span class="p">,</span> <span class="n">all_event_id</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">events_from_annotations</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">event_id</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Stimulus/S  5&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Stimulus/S  6&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                                                                        <span class="s1">&#39;Stimulus/S  7&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span>

<span class="n">epoched</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">Epochs</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">all_events</span><span class="p">,</span> <span class="n">event_id</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">standard</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">deviant</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span> <span class="n">tmin</span><span class="o">=-</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                        <span class="n">baseline</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">reject_by_annotation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">detrend</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">reject</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">preload</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">epoched</span><span class="o">.</span><span class="n">drop_bad</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Used Annotations descriptions: [np.str_(&#39;Stimulus/S  5&#39;), np.str_(&#39;Stimulus/S  6&#39;), np.str_(&#39;Stimulus/S  7&#39;)]
Not setting metadata
660 matching events found
Setting baseline interval to [-0.19921875, 0.0] s
Applying baseline correction (mode: mean)
Using data from preloaded Raw for 660 events and 257 original time points ...
39 bad epochs dropped
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epoched</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">filepath_save</span><span class="p">,</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.vhdr&#39;</span><span class="p">,</span> <span class="s1">&#39;_epo.fif&#39;</span><span class="p">)),</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../mvpure_py.utils.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">mvpure_py.utils</p>
      </div>
    </a>
    <a class="right-next"
       href="source_localization_and_reconstruction_on_data_from_oddball_paradigm.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Source localization and signal reconstruction - case study for oddball data</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#1.-Setup:-Importing-Necessary-Libraries">1. Setup: Importing Necessary Libraries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#2.-Loading-and-Inspecting-Raw-Data">2. Loading and Inspecting Raw Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Visual-Inspection">Visual Inspection</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#3.-Channel-Management">3. Channel Management</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Setting-the-Montage-(Electrode-Locations)">Setting the Montage (Electrode Locations)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#4.-Filtering-and-Artifact-Detection">4. Filtering and Artifact Detection</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#High-Pass-Filtering">High-Pass Filtering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Automated-Bad-Channel-and-Segment-Detection">Automated Bad Channel and Segment Detection</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Low-Pass-Filtering-(for-ICA)">Low-Pass Filtering (for ICA)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#5.-Rereferencing">5. Rereferencing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#6.-Independent-Component-Analysis-(ICA)-for-Artifact-Removal">6. Independent Component Analysis (ICA) for Artifact Removal</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#7.-Final-Processing-Steps">7. Final Processing Steps</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Final-Low-Pass-Filter">Final Low-Pass Filter</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Interpolate-Bad-Channels-and-Resample">Interpolate Bad Channels and Resample</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Final-Check-for-Artifacts-and-Saving">Final Check for Artifacts and Saving</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#8.-Epoching-and-Baseline-Correction">8. Epoching and Baseline Correction</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/tutorials/preprocessing_data_from_oddball paradigm.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      ¬© Copyright 2025, Julia Jurkowska et al.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>